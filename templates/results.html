<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Forecast Results</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="/static/style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Pacifico&display=swap" rel="stylesheet">
</head>

<body>

  <div class="watermark">Made by <span>Ajay Sharma</span></div>

  <div class="container fade-in">

    <div class="chart-box scale-in" id="chartWrap" style="margin-top: 28px;">

      <div class="top-row">
        <div>
          <div class="subtitle">Forecast Result</div>
          <div class="prediction" id="predictionCounter">Predicted Next Day Sales: â‚¹ <span id="predValue">{{ prediction }}</span></div>
        </div>

        <a href="/" class="btn">New Prediction</a>
      </div>

      <div class="chart-box scale-in" id="chartWrap">
        <canvas id="chart"></canvas>
      </div>

      <a class="btn mt20" href="/download_csv">Download CSV</a>

    </div>

  </div>

<script>
  // data from server
  const labels = {{ dates|tojson }};
  const actual = {{ actuals|tojson }};
  const predicted = {{ predicted|tojson }};
  const rawPrediction = Number({{ prediction }}); // ensures numeric

  // animate chart
  const ctx = document.getElementById("chart").getContext("2d");
  const chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [
        {
          label: "Actual",
          data: actual,
          borderColor: "#3b82f6",
          fill: false,
          tension: 0.3,
          pointRadius: 0
        },
        {
          label: "Predicted",
          data: predicted,
          borderColor: "#06b6d4",
          borderDash: [6, 4],
          tension: 0.3,
          fill: false,
          pointRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      animation: { duration: 900, easing: "easeOutQuart" },
      plugins: {
        legend: { labels: { color: '#cbd5e1' } }
      },
      scales: {
        x: { ticks: { color: '#94a3b8' } },
        y: { ticks: { color: '#94a3b8' } }
      }
    }
  });

  // Reveal animation: slide chart from below
  const chartWrap = document.getElementById('chartWrap');
  chartWrap.classList.add('reveal');

  // Count-up animation for numeric prediction
  (function animateNumber(targetElId, endValue, duration = 1200) {
    const el = document.getElementById(targetElId);
    if (!el) return;
    const start = 0;
    const range = endValue - start;
    const startTime = performance.now();

    function step(now) {
      const elapsed = now - startTime;
      const pct = Math.min(elapsed / duration, 1);
      const current = Math.round(start + range * pct);
      el.textContent = current.toLocaleString();
      if (pct < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  })('predValue', rawPrediction, 1200);

</script>

</body>
</html>
